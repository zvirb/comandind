[pytest]
pythonpath = .
testpaths = tests
addopts = 
    --strict-markers
    --strict-config
    --verbose
    --cov=app
    --cov-report=html:coverage_html
    --cov-report=xml:coverage.xml
    --cov-report=term-missing
    --cov-fail-under=80
    --cov-branch
    --html=test_reports/pytest_report.html
    --self-contained-html
    --junitxml=test_reports/junit.xml
    --timeout=300
markers =
    unit: Unit tests for individual functions/classes
    integration: Integration tests between components
    e2e: End-to-end tests simulating user workflows
    api: API endpoint tests
    auth: Authentication and authorization tests
    security: Security vulnerability tests
    performance: Performance and load tests
    database: Database operation tests
    worker: Background task/worker tests
    frontend: Frontend component and UI tests
    slow: Tests that take longer than 10 seconds
    external: Tests requiring external services
    migration: Database migration tests
    regression: Regression tests for previously fixed bugs
filterwarnings =
    ignore:directory "/run/secrets" does not exist:UserWarning
    ignore::DeprecationWarning:passlib
    ignore::pytest.PytestUnraisableExceptionWarning
env =
    # Test environment configuration
    TESTING=1
    POSTGRES_PASSWORD=testpassword
    API_KEY=testkey
    JWT_SECRET_KEY=test-jwt-secret-key-for-testing-only
    QDRANT_API_KEY=
    OLLAMA_EMBEDDING_MODEL_NAME=test-embedding-model
    REDIS_URL=redis://localhost:6379/1
    CELERY_BROKER_URL=redis://localhost:6379/1
    CELERY_RESULT_BACKEND=redis://localhost:6379/1