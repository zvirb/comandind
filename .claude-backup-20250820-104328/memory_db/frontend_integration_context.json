{
  "package_id": "frontend_integration_context",
  "package_type": "migrated-context",
  "content": "{\n  \"phase\": \"integration_adaptation\",\n  \"priority\": \"high\",\n  \"agent\": \"webui-architect\",\n  \"focus\": \"Adapt frontend to work with normalized backend responses\",\n  \n  \"required_updates\": {\n    \"auth_context\": {\n      \"location\": \"/app/webui-next/src/context/AuthContext.jsx\",\n      \"changes\": [\n        \"Update checkAuth() to handle normalized session format\",\n        \"Add fallback UI state for degraded mode\",\n        \"Ensure token refresh works with dual formats\"\n      ],\n      \"expected_response_format\": {\n        \"valid\": \"boolean\",\n        \"user_id\": \"string\",\n        \"email\": \"string\", \n        \"expires_at\": \"number\",\n        \"session_id\": \"string\",\n        \"metadata\": \"object\"\n      }\n    },\n    \n    \"websocket_client\": {\n      \"location\": \"/app/webui-next/src/services/websocket.js\",\n      \"changes\": [\n        \"Add JWT token to WebSocket connection params\",\n        \"Handle auth rejection before connection\",\n        \"Implement reconnect with fresh token\"\n      ],\n      \"auth_flow\": \"Get token from AuthContext \u2192 Attach to WS URL \u2192 Handle auth errors\"\n    },\n    \n    \"csrf_handling\": {\n      \"location\": \"/app/webui-next/src/services/api.js\",\n      \"changes\": [\n        \"Consistent CSRF token handling across environments\",\n        \"Add development mode detection\",\n        \"Handle CSRF token refresh on 403\"\n      ]\n    },\n    \n    \"error_boundaries\": {\n      \"location\": \"/app/webui-next/src/components/ErrorBoundary.jsx\",\n      \"changes\": [\n        \"Add specific handling for session errors\",\n        \"Show degraded mode indicator\",\n        \"Provide manual session refresh option\"\n      ]\n    }\n  },\n  \n  \"degraded_mode_ui\": {\n    \"indicators\": [\n      \"Orange banner: 'Running in offline mode - some features limited'\",\n      \"Disable real-time features gracefully\",\n      \"Show last sync timestamp\",\n      \"Provide manual sync button\"\n    ],\n    \"behavior\": [\n      \"Continue working with cached data\",\n      \"Queue actions for when connection restored\",\n      \"Auto-retry connection every 30 seconds\"\n    ]\n  },\n  \n  \"testing_scenarios\": [\n    \"Login with legacy token format (email as sub)\",\n    \"Login with enhanced token format (user_id as sub)\",\n    \"Navigate while Redis is down (fallback mode)\",\n    \"WebSocket connection with valid/invalid auth\",\n    \"CSRF token handling in dev vs prod\"\n  ],\n  \n  \"success_criteria\": [\n    \"No logout on Documents/Calendar navigation\",\n    \"WebSocket connects with authentication\",\n    \"Graceful degradation when Redis unavailable\",\n    \"Consistent behavior dev/prod environments\"\n  ]\n}",
  "tokens": 332,
  "created_at": "2025-08-18T15:14:25.843397",
  "last_accessed": "2025-08-18T15:14:25.843409",
  "priority": "medium",
  "context_tags": [
    "migrated",
    "context-package"
  ]
}